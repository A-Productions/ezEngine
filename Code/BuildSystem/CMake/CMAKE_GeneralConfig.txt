#cmake

MACRO(ADD_MSVC_PRECOMPILED_HEADER)
  IF(MSVC)
    set (PCH_FOUND false)
    set (PCH_CPP "")
    set (PCH_H "")

    foreach (src_file ${ALL_SOURCE_FILES})
      GET_FILENAME_COMPONENT(RawFilename ${src_file} NAME_WE)
      GET_FILENAME_COMPONENT(Extension ${src_file} EXT)

      if (${Extension} STREQUAL ".cpp")
        if (RawFilename MATCHES "PCH$")
          set (PCH_FOUND true)
          set (PCH_CPP "${RawFilename}.cpp")
          set (PCH_H "${RawFilename}.h")
        endif()
      endif ()

    endforeach ()

    if (NOT EZ_USE_PCH)
      set (PCH_FOUND false)
    endif()

    if (PCH_FOUND)
	  ez_pch_create(${PCH_CPP} ${PCH_H})

      foreach (src_file ${ALL_SOURCE_FILES})
        GET_FILENAME_COMPONENT(RawFilename ${src_file} NAME_WE)
        GET_FILENAME_COMPONENT(Extension ${src_file} EXT)

        if (${Extension} STREQUAL ".cpp")
          if (NOT RawFilename MATCHES "PCH$")
            # We don't want to enable PCH usage for QRC files (they all start with qrc_)
			if (NOT ${src_file} MATCHES ".*(/qrc_).*")
			  ez_pch_use(${src_file} ${PCH_H})
            endif ()
          endif ()
        endif ()

      endforeach ()

    endif()

  ENDIF()
ENDMACRO()
